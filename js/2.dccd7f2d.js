(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{5306:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.minimized?t._e():i("q-page",[i("q-page-sticky",{attrs:{expand:"",position:"top"}},[i("q-toolbar",{staticClass:"text-white bg-primary"},[i("q-toolbar-title",{class:["title",t.frame?"q-ml-xl":""],staticStyle:{"max-height":"32px"},attrs:{shrink:""}},[i("q-input",{staticStyle:{"max-height":"32px"},attrs:{"input-class":"text-white text-lg q-py-none",placeholder:"Enter name of script",borderless:""},model:{value:t.doc.name,callback:function(e){t.$set(t.doc,"name",e)},expression:"doc.name"}})],1),t.frame&&t.isSignedIn?i("q-btn",{attrs:{icon:"arrow_drop_down",id:"open",size:"md",flat:"",dense:"","text-color":"accent"}},[i("q-tooltip",[t._v("Open an existing script")]),i("q-menu",{attrs:{anchor:"bottom left",self:"top right","auto-close":""}},[i("q-list",[i("q-item",{key:":new",staticClass:"text-bold",attrs:{dense:"",clickable:""},on:{click:function(e){return t.initialize()}}},[t._v("\n\t\t\t\t\t\t\t--- New Script ---\n\t\t\t\t\t\t")]),t._l(t.scriptList,(function(e){return i("q-item",{key:e.id,attrs:{dense:"",clickable:""},on:{click:function(i){return t.selectScript(e)}}},[e.description?i("q-tooltip",[i("span",{domProps:{innerHTML:t._s(e.description)}})]):t._e(),i("q-item-section",[t._v(" "+t._s(e.title)+" ")])],1)}))],2)],1)],1):t._e(),i("q-space"),t.isDev?i("q-btn",{attrs:{id:"json",icon:"code","text-color":"accent",flat:"",dense:"",round:""},on:{click:function(e){return e.stopPropagation(),t.showJSON(e)}}},[i("q-tooltip",[t._v("Edit raw JSON")])],1):t._e(),t.guide?i("q-btn",{attrs:{id:"guide",icon:"img:statics/support_agent-white-48dp.svg","text-color":"accent",flat:"",dense:"",round:""},on:{click:function(e){return e.stopPropagation(),t.showGuide(e)}}},[i("q-tooltip",[t._v("Show a guide of this script")])],1):t._e(),i("q-btn",{attrs:{id:"save",icon:"save",disable:t.isPublic||!t.changed,flat:"",dense:"",round:""},on:{click:t.saveScript}},[i("q-tooltip",[t._v("Save the script")])],1),i("q-btn",{attrs:{id:"build",icon:"update",disable:t.isPublic,flat:"",dense:"",round:""},on:{click:t.buildScript}},[i("q-tooltip",[t._v("Update Published Code")])],1),i("q-btn",{attrs:{id:"delete",icon:"delete",flat:"",dense:"",round:"",disable:!t.canDelete},on:{click:function(e){t.confirmDelete=!0}}},[i("q-tooltip",[t._v("Delete the script")])],1),t.isDev?i("q-btn",{attrs:{id:"download",icon:"cloud_download",flat:"",dense:"",round:""},on:{click:t.downloadDocument}},[i("q-tooltip",[t._v("Download the script as JSON file")])],1):t._e(),t.canPublish?i("q-btn",{attrs:{id:"publish",icon:"publish",flat:"",dense:"",round:""},on:{click:t.publishScript}},[i("q-tooltip",[t._v("Publish the script")])],1):t._e(),t.frame?i("user-menu"):t._e()],1)],1),t.waitForSignin?i("q-banner",{staticClass:"q-pt-xl"},[i("span",{staticClass:"text-subtitle1 bg-warning"},[t._v("\n\t\t\tYou need to signin in order to view the script\n\t\t")])]):t._e(),i("editor",{ref:"editor",staticClass:"q-pt-xl editor",attrs:{doc:t.doc,frame:t.frame,packages:t.packages,type:t.doc.$type||"any","load-doc-to-dictionary":""},on:{"select-element":t.onSelectElement,update:function(e){return t.$parent.$emit("update",e)}}}),i("q-dialog",{attrs:{persistent:"",maximized:""},model:{value:t.editJSON,callback:function(e){t.editJSON=e},expression:"editJSON"}},[i("q-card",[i("q-card-section",[i("q-input",{attrs:{value:JSON.stringify(t.doc,null,"  "),autogrow:"",type:"textarea",filled:""},on:{input:t.updateJSON}})],1),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"OK",color:"primary"}})],1)],1)],1),i("q-dialog",{attrs:{persistent:""},model:{value:t.confirmDelete,callback:function(e){t.confirmDelete=e},expression:"confirmDelete"}},[i("q-card",[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("\n\t\t\t\t\tDelete script\n\t\t\t\t")])]),i("q-card-section",[t._v("\n\t\t\t\tAre you sure you want to delete this script?\n\t\t\t")]),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Delete",color:"primary"},on:{click:t.deleteScript}})],1)],1)],1),i("q-page-sticky",{attrs:{position:"bottom-right",offset:[24,24]}},[i("q-btn",{attrs:{round:"",color:"accent",icon:"chat",title:"Send us an email!"},on:{click:function(e){return e.preventDefault(),t.sendFeedback(e)}}})],1)],1)},s=[],o=i("a897"),n=i("3c4e"),r=i.n(n),c=i("21a6"),d=i("92da"),l=i("75ba"),h=i("da50"),p=i("cf57"),u=i("db49"),g=i("761e"),b=i("1cb6"),m={name:"ScriptPage",props:{frame:{type:Boolean,default:!1}},data(){return{doc:r()({},u["a"]),confirmDelete:!1,editJSON:!1,changed:!1,minimized:!1,name:"Script Name",scriptList:this.$store.state.docs,packages:[],waitForSignin:!1,guide:null}},components:{editor:o["a"],"user-menu":g["a"]},meta(){return{title:this.doc.title||this.doc.name||"Script"}},async mounted(){if(this.$route.params.id&&":new"!==this.$route.params.id){if(!this.$store.state.user.isSignedIn&&!this.isPublic)return this.waitForSignin=!0,void(this.doc.name="Waiting for signin");const e=await this.loadScript();if(!e)return;this.$q.loading.show({spinner:p["a"],message:"Updating script view"});try{await this.$refs.editor.updateDoc(this.doc),this.$q.loading.hide()}catch(t){this.$q.loading.hide(),t.error===h["f"]?Object(h["k"])("The document was not found"):Object(h["k"])("There was an error updating script view")}}else Object(b["a"])("script","new"),this.initialize()},computed:{isDev(){return!1},canPublish(){return!this.isPublic&&this.$store.state.user.canPublish},docId(){return this.doc._id||this.doc.$id},canDelete(){return(!this.$route.params.id||!this.$route.params.id.startsWith("public:"))&&!!this.$route.params.id},isSignedIn(){return this.$store.state.user.isSignedIn},isPublic(){return"string"===typeof this.$route.params.id&&this.$route.params.id.startsWith("public:")}},watch:{doc:{deep:!0,handler:function(){this.changed=!0}},isSignedIn(){this.isPublic||this.loadScript()}},methods:{async initialize(){this.doc=await this.createNewScript()},onSelectElement(t){this.$parent.$emit("select-element",t)},async selectScript(t){t&&t.id&&(await this.$router.replace("/frame/"+t.id),await this.loadScript())},async publishScript(){if(this.$store.state.user.isSignedIn){this.doc.name||Object(h["k"])("The name should be filled in before publishing the script");try{this.$q.loading.show(),await this.$store.dispatch("publishDoc",this.doc),this.$q.loading.hide(),this.$q.notify("published script")}catch(t){this.$q.loading.hide(),Object(h["k"])(t.message||"There was an error publishing the script"),console.error("Exception",t)}}else Object(h["k"])("You must sign in before publishing the script")},async deleteScript(){this.$q.loading.show();try{await this.$store.dispatch("deleteDoc",this.doc._id),this.$q.loading.hide()}catch(t){switch(this.$q.loading.hide(),console.error("deleteDoc failed",t),t.error){default:Object(h["k"])("Could not delete the script")}}this.frame?this.$router.push("/frame/:new"):this.$router.push("/scripts")},showGuide(){if(this.guide)return Object(d["b"])(this.doc,this.guide)},showJSON(){this.editJSON=!0},async buildScript(){this.$q.loading.show({spinner:p["a"],message:"Generating script code"});try{const t=await this.$store.dispatch("buildDoc",this.doc._id);console.info(t),this.$q.loading.hide()}catch(t){Object(h["k"])("There was an error processing the script"),console.error(t),this.$q.loading.hide()}},runScript(){this.$q.dialog({title:"Execute Script",message:'This script is still in Concept Proof mode so it cannot be executed. <br>Would you like such a script to be implemented? Do you think it will be helpful? <a target="_blank" href="mailto:elshor@gmail.com?subject=Natura script review - Wikipedia script">Send us your feedback!</a>',html:!0})},async createNewScript(){const t=r()({},u["a"]);return this.$route.query.package&&t.packages.push(this.$route.query.package),await this.loadPackages(),t},async loadScript(){if(":new"===this.$route.params.id||!this.$route.params.id)return!1;try{this.$q.loading.show();const t=this.$route.params.id,e=t.includes(":")?t:"public:"+t,i=await this.$store.dispatch("loadDoc",e);return Object(b["a"])("script","load",this.$route.params.id),this.waitForSignin=!1,this.$set(this,"doc",i),this.$nextTick(()=>this.changed=!1),this.$q.loading.hide(),this.$store.dispatch("loadGuide",e).then(t=>{this.guide=t,t&&Object(d["a"])(i)&&setTimeout(()=>Object(d["b"])(i,t),5e3)}),await this.loadPackages(),!0}catch(t){switch(this.$q.loading.hide(),t.error){case h["d"]:Object(h["k"])("You need to sign in before loading the document");break;case h["f"]:Object(h["k"])("The document was not found");break;default:Object(h["k"])("There was an error loading the document"),console.error("Exception",t)}return!1}},async loadPackages(){try{const t=await this.$store.dispatch("getPackages",this.doc.packages);this.packages.splice(0,this.packages.length,...t)}catch(t){console.error("Exception loading packages",t),Object(h["k"])("There was an error loading some required packages for the document")}},async saveScript(){this.$q.loading.show();try{await this.$store.dispatch("storeDoc",{doc:this.doc,id:this.doc._id}),this.$route.params.id!==this.docId&&(this.frame?this.$router.replace("/frame/"+this.docId):this.$router.replace("/script/"+this.docId)),this.$q.loading.hide(),this.changed=!1,this.$q.notify("Saved script")}catch(t){switch(this.$q.loading.hide(),t.error){case h["d"]:Object(h["k"])("You need to sign-in before saving this document");break;case h["e"]:Object(h["k"])("You are not authorized to save this document");break;case h["f"]:Object(h["k"])("The document was not found");break;default:Object(h["k"])("There was an error saving the document. Try again later")}}},sendFeedback(){Object(l["c"])()},downloadDocument(){const t=new Blob([JSON.stringify(this.doc,null,"\t")],{type:"application/json;charset=utf-8"});Object(c["saveAs"])(t,(this.doc.name||this.docId)+".json")},updateJSON(t){try{this.doc=JSON.parse(t)}catch(e){}}}},f=m,w=(i("d681"),i("2877")),q=i("9989"),k=i("de5e"),$=i("65c6"),S=i("6ac5"),y=i("27f9"),v=i("9c40"),O=i("05c0"),_=i("4e73"),x=i("1c1c"),j=i("66e5"),D=i("4074"),P=i("2c91"),N=i("54e1"),T=i("24e8"),Q=i("f09f"),J=i("a370"),C=i("4b7e"),I=i("7f67"),E=i("eebe"),z=i.n(E),F=Object(w["a"])(f,a,s,!1,null,"1e02ac71",null);e["default"]=F.exports;z()(F,"components",{QPage:q["a"],QPageSticky:k["a"],QToolbar:$["a"],QToolbarTitle:S["a"],QInput:y["a"],QBtn:v["a"],QTooltip:O["a"],QMenu:_["a"],QList:x["a"],QItem:j["a"],QItemSection:D["a"],QSpace:P["a"],QBanner:N["a"],QDialog:T["a"],QCard:Q["a"],QCardSection:J["a"],QCardActions:C["a"]}),z()(F,"directives",{ClosePopup:I["a"]})},d681:function(t,e,i){"use strict";var a=i("e1a8"),s=i.n(a);s.a},e1a8:function(t,e,i){}}]);